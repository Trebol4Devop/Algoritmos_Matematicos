import 'NevilleMethodClass.Dart';
import 'dart:math';

void main() {
  print('=== PRUEBA DEL M√âTODO DE NEVILLE ===\n');

  // Prueba 1: Funci√≥n cuadr√°tica con puntos conocidos
  print('--- PRUEBA 1: f(x) = x¬≤ (Puntos: (1,1), (2,4), (3,9)) ---');
  testNevilleMethod(
    dataTable: [
      [0.0, 1.0, 1.0],
      [1.0, 2.0, 4.0],
      [2.0, 3.0, 9.0],
    ],
    c: 2.5,
    dn: 6,
    expectedResult: 6.25,
    testName: 'Funci√≥n cuadr√°tica'
  );

  // Prueba 2: Funci√≥n seno con puntos equidistantes
  print('\n--- PRUEBA 2: f(x) = sin(x) (Puntos en [0, œÄ/2]) ---');
  testNevilleMethod(
    dataTable: [
      [0.0, 0.0, 0.0],
      [1.0, pi/6, sin(pi/6)],
      [2.0, pi/4, sin(pi/4)],
      [3.0, pi/3, sin(pi/3)],
      [4.0, pi/2, sin(pi/2)],
    ],
    c: pi/5,
    dn: 6,
    expectedResult: sin(pi/5),
    testName: 'Funci√≥n seno'
  );

  // Prueba 3: Funci√≥n exponencial
  print('\n--- PRUEBA 3: f(x) = e^x (Puntos en [0, 2]) ---');
  testNevilleMethod(
    dataTable: [
      [0.0, 0.0, exp(0)],
      [1.0, 0.5, exp(0.5)],
      [2.0, 1.0, exp(1)],
      [3.0, 1.5, exp(1.5)],
      [4.0, 2.0, exp(2)],
    ],
    c: 1.2,
    dn: 6,
    expectedResult: exp(1.2),
    testName: 'Funci√≥n exponencial'
  );

  // Prueba 4: Polinomio c√∫bico
  print('\n--- PRUEBA 4: f(x) = x¬≥ - 2x + 1 ---');
  testNevilleMethod(
    dataTable: [
      [0.0, -2.0, pow(-2, 3) - 2*(-2) + 1],
      [1.0, -1.0, pow(-1, 3) - 2*(-1) + 1],
      [2.0, 0.0, pow(0, 3) - 2*0 + 1],
      [3.0, 1.0, pow(1, 3) - 2*1 + 1],
      [4.0, 2.0, pow(2, 3) - 2*2 + 1],
    ],
    c: 0.5,
    dn: 6,
    expectedResult: pow(0.5, 3) - 2*0.5 + 1,
    testName: 'Polinomio c√∫bico'
  );

  // Prueba 5: Caso con pocos puntos
  print('\n--- PRUEBA 5: Solo 2 puntos (interpolaci√≥n lineal) ---');
  testNevilleMethod(
    dataTable: [
      [0.0, 1.0, 2.0],
      [1.0, 3.0, 6.0],
    ],
    c: 2.0,
    dn: 6,
    expectedResult: 4.0,
    testName: 'Interpolaci√≥n lineal'
  );

  // Prueba 6: Caso con muchos puntos
  print('\n--- PRUEBA 6: 6 puntos para f(x) = 1/(1+x¬≤) ---');
  List<List<double>> dataTable6 = [];
  for (int i = 0; i < 6; i++) {
    double x = -2.5 + i;
    dataTable6.add([i.toDouble(), x, 1/(1 + x*x)]);
  }
  testNevilleMethod(
    dataTable: dataTable6,
    c: 0.3,
    dn: 8,
    expectedResult: 1/(1 + 0.3*0.3),
    testName: 'Funci√≥n racional'
  );

  // Prueba 7: Caso de error - tabla vac√≠a
  print('\n--- PRUEBA 7: Tabla de datos vac√≠a (debe fallar) ---');
  testNevilleMethod(
    dataTable: [],
    c: 1.0,
    dn: 6,
    testName: 'Tabla vac√≠a'
  );

  // Prueba 8: Caso de error - m√°s de 25 puntos
  print('\n--- PRUEBA 8: Demasiados puntos (m√°s de 25) ---');
  List<List<double>> dataTable26 = [];
  for (int i = 0; i < 26; i++) {
    dataTable26.add([i.toDouble(), i.toDouble(), i.toDouble()]);
  }
  testNevilleMethod(
    dataTable: dataTable26,
    c: 12.5,
    dn: 6,
    testName: 'Demasiados puntos'
  );
}

void testNevilleMethod({
  required List<List<double>> dataTable,
  required double c,
  required int dn,
  double? expectedResult,
  required String testName,
}) {
  try {
    print('Tabla de datos:');
    for (int i = 0; i < dataTable.length; i++) {
      print('  Punto ${dataTable[i][0]}: (${dataTable[i][1]}, ${dataTable[i][2]})');
    }
    print('Punto de interpolaci√≥n (c): $c');
    print('Decimales: $dn');

    // Crear instancia del m√©todo
    var neville = NevilleMethodClass(
      n: dataTable.length,
      c: c,
      dn: dn,
      dataTable: dataTable,
    );

    // Ejecutar el m√©todo
    neville.nevilleMethod();

    // Mostrar resultados
    print('\n‚úÖ $testName');
    print('√âxito: ${neville.success}');
    print('Mensaje: ${neville.message}');
    
    if (neville.success) {
      print('Resultado interpolado: ${neville.result}');
      print('Iteraciones: ${neville.iterations}');
      
      if (expectedResult != null) {
        double errorAbsoluto = (neville.result - expectedResult).abs();
        print('Resultado esperado: $expectedResult');
        print('Error absoluto: $errorAbsoluto');
        print('Error relativo: ${(errorAbsoluto / expectedResult.abs() * 100).toStringAsFixed(6)}%');
      }

      // Mostrar tabla de Neville (solo si es peque√±a)
      if (neville.nevilleTable.isNotEmpty && dataTable.length <= 5) {
        print('\nüìä Tabla de Neville:');
        var tablaResultados = neville.obtenerTablaResultados();
        for (var fila in tablaResultados) {
          print(fila.join('\t| '));
        }
      } else if (neville.nevilleTable.isNotEmpty) {
        print('\nüìä Tabla de Neville disponible (${dataTable.length} puntos)');
      }

      // Mostrar polinomio interpolante
      print('\nüìê Polinomio interpolante:');
      print(neville.obtenerPolinomioInterpolante());

      // An√°lisis de la interpolaci√≥n
      var analisis = neville.analizarInterpolacion();
      print('\nüìà An√°lisis de interpolaci√≥n:');
      analisis.forEach((key, value) {
        print('$key: $value');
      });

      // Evaluar en puntos adicionales
      if (dataTable.length >= 3) {
        print('\nüîç Evaluaci√≥n en puntos adicionales:');
        double xTest1 = (dataTable[0][1] + dataTable[1][1]) / 2;
        double xTest2 = (dataTable[dataTable.length-2][1] + dataTable[dataTable.length-1][1]) / 2;
        
        double yTest1 = neville.evaluarEnPunto(xTest1);
        double yTest2 = neville.evaluarEnPunto(xTest2);
        
        print('P($xTest1) ‚âà $yTest1');
        print('P($xTest2) ‚âà $yTest2');
      }
    }

  } catch (e) {
    print('\n‚ùå Error en $testName: $e');
  }
  print('\n' + '='*80 + '\n');
}

// Funci√≥n auxiliar para mostrar puntos del polinomio
void mostrarPuntosPolinomio(NevilleMethodClass neville) {
  var puntos = neville.obtenerPuntosPolinomio(numPuntos: 10);
  var puntosOriginales = neville.obtenerPuntosOriginales();
  
  print('\nüìà Puntos del polinomio interpolante:');
  print('x\t\t| y interpolado');
  print('-' * 40);
  
  for (var punto in puntos) {
    print('${punto['x']!.toStringAsFixed(4)}\t| ${punto['y']!.toStringAsFixed(6)}');
  }
  
  print('\nüìå Puntos originales:');
  print('x\t\t| y original');
  print('-' * 40);
  
  for (var punto in puntosOriginales) {
    print('${punto['x']!.toStringAsFixed(4)}\t| ${punto['y']!.toStringAsFixed(6)}');
  }
}
